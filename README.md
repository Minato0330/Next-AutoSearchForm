# お問い合わせフォーム自動検出システム

企業の公式ウェブサイトから日本語のお問い合わせページを自動的に検出・分析するNext.jsアプリケーションです。Playwrightを使用してWebスクレイピングを行います。

## 🎯 プロジェクト概要

このツールは、企業のホームページから日本語のお問い合わせページを自動的に発見し、フォームの構造を分析します。約300社のウェブサイトを分析し、成功率を測定することを目的としています。

### 主な機能

- ✅ **日本語お問い合わせページの自動検出**: 企業ホームページから日本語のお問い合わせページを優先的に検出
- ✅ **厳格な言語フィルタリング**: 日本語ページのみを検出し、英語などの他言語ページを除外
- ✅ **URLパターン認識**: `/jp/contact/`、`/ja/contact/`などの日本語URLパターンを自動検出
- ✅ **SPA対応**: React、Vue、Angular、Next.jsなどのJavaScriptフレームワークに対応
- ✅ **フォーム構造解析**: フォームフィールド、タイプ、ラベル、必須項目を分析
- ✅ **入力可能性評価**: フォームを「完全入力可能」「部分的に入力可能」「入力不可」に分類
- ✅ **レポート生成**: CSV・JSON形式で結果をエクスポート

## 🚀 セットアップ

### 必要な環境

- Node.js 18以上
- npm または yarn

### インストール手順

1. リポジトリをクローン

2. 依存関係をインストール:

```bash
npm install
```

3. Playwrightブラウザをインストール:

```bash
npx playwright install chromium
```

### 使い方

#### 方法1: Webインターフェース

1. 開発サーバーを起動:

```bash
npm run dev
```

2. ブラウザで [http://localhost:3000](http://localhost:3000) を開く
3. 企業URLを入力欄に入力
4. 「お問い合わせページを検索」ボタンをクリック
5. 検出されたお問い合わせページのURLが表示されます

#### 方法2: コマンドライン

1. `data/sample-companies.ts` に企業リストを追加
2. 分析を実行:

```bash
npm run analyze
```

3. 結果は `results/` ディレクトリに保存されます

## 📊 出力内容

分析ツールは以下の情報を含むレポートを生成します:

- 企業URL
- お問い合わせページ検出結果（有/無）
- お問い合わせページURL
- 動的コンテンツ読み込み（有/無）
- 入力可能性ステータス（完全/部分的/不可/フォームなし）
- フィールド詳細（抽出されたフォーム構造）
- エラーメッセージ（該当する場合）

### 追跡される指標

1. **フォーム検出成功率**: お問い合わせページが見つかったウェブサイトの割合
2. **動的コンテンツ読み込み成功率**: SPA/JSコンテンツが正しく読み込まれたページの割合
3. **自動入力可能性の内訳**:
   - 完全入力可能
   - 部分的に入力可能
   - 入力不可
   - フォームなし

## 🏗️ プロジェクト構成

```
├── app/                    # Next.jsアプリディレクトリ
│   ├── api/
│   │   ├── analyze/       # 分析APIルート
│   │   ├── find-contact/  # お問い合わせページ検索API
│   │   └── extract-form/  # フォーム抽出API
│   ├── analyze/           # 分析UIページ
│   └── page.tsx           # ホームページ
├── lib/                   # コアライブラリモジュール
│   ├── analyzer.ts        # メインオーケストレーション
│   ├── contact-page-discovery.ts  # お問い合わせページ検出ロジック
│   ├── spa-handler.ts     # SPA処理
│   ├── form-extractor.ts  # フォーム抽出
│   ├── fillability-assessor.ts  # 入力可能性評価
│   ├── report-generator.ts  # レポート生成
│   └── types.ts           # TypeScript型定義
├── data/                  # 企業データ
│   └── sample-companies.ts
├── scripts/               # CLIスクリプト
│   ├── analyze.ts
│   └── find-contact-page.ts
└── results/               # 生成されたレポート（gitignore対象）
```

## 🔧 設定

`scripts/analyze.ts` またはAPI呼び出し時に分析設定を編集できます:

```typescript
const config = {
  timeout: 30000,        // リクエストタイムアウト（ミリ秒）
  headless: true,        // ヘッドレスモードでブラウザを実行
  maxRetries: 2,         // 最大リトライ回数
  preferredLanguage: "ja" // 優先言語（日本語）
};
```

## 📝 対応言語

このシステムは日本語のお問い合わせページを優先的に検出します:

### 日本語URLパターン
- `/ja/`、`/jp/`、`/jp-ja/`、`/ja-jp/`、`/ja_jp/`、`/jp_ja/`、`/japanese/`

### 日本語キーワード
- 「お問い合わせ」「問い合わせ」「コンタクト」「お問合せ」「問合せ」「連絡」など

### 英語ページの除外
- `/en/`、`/us/`、`/uk/`、`/de/`、`/fr/`などの非日本語URLは自動的に除外されます

## 🔍 日本語お問い合わせページ検出の仕組み

### 1. URLパターン検出
システムは以下のパターンを自動的に検出します:
- `/jp/contact/` → 日本電産（Nidec）などで使用
- `/ja-jp/contact/` → オムロン（Omron）などで使用
- `/ja/contact/` → 一般的な日本語サイトで使用

### 2. スコアリングシステム
- 日本語URL: **+500点**（最優先）
- 非日本語URL: **-1000点**（完全除外）
- お問い合わせキーワード: +70点
- 短いURL: 優先

### 3. 厳格なフィルタリング
`preferredLanguage: "ja"` が設定されている場合:
- 日本語URLのみを返す
- 英語などの他言語ページは完全に除外
- 日本語ページが見つからない場合はエラーを返す

## ⚠️ 現在の制限事項

- ❌ 実際のフォーム送信は行いません
- ❌ CAPTCHA回避機能なし（手動のみ）
- ✅ 分析のみ実行

## 🔮 将来の拡張機能（現在のスコープ外）

- フォームの自動入力
- 送信ロジック
- CAPTCHA処理
- LinkedIn連携
- CSVインポート
- API統合

## 🧪 テスト済み企業サイト

以下の企業サイトで日本語お問い合わせページの検出をテスト済み:

- ✅ 日本電産（Nidec）: `https://www.nidec.com/jp/contact/`
- ✅ オムロン（Omron）: `https://components.omron.com/ja-jp/contact`
- ✅ SMC: `https://www.smcworld.com/support/contact/ja-jp/`
- ✅ 安川電機（Yaskawa）: `https://www.yaskawa.co.jp/contact/`
- ✅ ファナック（FANUC）: `https://www.fanuc.co.jp/ja/contact/form/index.html`

## 📄 ライセンス

MIT

## 🤝 貢献

このプロジェクトはデモプロジェクトです。自由にフォークして拡張してください。

